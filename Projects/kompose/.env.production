# ===================================================================
# KOMPOSE - Production Configuration
# ===================================================================
# This file is for LOCAL DEVELOPMENT ONLY
# Copy to .env for local development: cp .env.production .env
# Or use: ./kompose.sh prod:start
# ===================================================================

# -------------------------------------------------------------------
# Domain Configuration
# -------------------------------------------------------------------
# Load local domain configuration
[ -f "$(dirname "${BASH_SOURCE[0]:-$0}")/domain.env.local" ] && source "$(dirname "${BASH_SOURCE[0]:-$0}")/domain.env.local" 2>/dev/null || true

# Build local URLs (using localhost with ports)
TRAEFIK_HOST_PROXY=localhost:8080
TRAEFIK_HOST_AUTH=localhost:8180
TRAEFIK_HOST_AUTO=localhost:3000
TRAEFIK_HOST_BLOG=localhost:3002
TRAEFIK_HOST_CHAIN=localhost:5678
TRAEFIK_HOST_CHAT=localhost:8085
TRAEFIK_HOST_MAIL=localhost:8025
TRAEFIK_HOST_CODE=localhost:3001
TRAEFIK_HOST_DASH=localhost:3006
TRAEFIK_HOST_DATA=localhost:3005
TRAEFIK_HOST_DOCK=localhost:5000
TRAEFIK_HOST_DOCS=localhost:3003
TRAEFIK_HOST_HOME=localhost:8123
TRAEFIK_HOST_LINK=localhost:3009
TRAEFIK_HOST_NEWS=localhost:3004
TRAEFIK_HOST_SEXY=localhost:8055
TRAEFIK_HOST_TRACE=localhost:3008
TRAEFIK_HOST_TRACK=localhost:3007
TRAEFIK_HOST_VAULT=localhost:8081
TRAEFIK_HOST_VPN=localhost:51821
TRAEFIK_HOST_OAUTH2=localhost:4180
TRAEFIK_HOST_MANAGE=localhost:3100
TRAEFIK_HOST_ZIGBEE=localhost:8080

# -------------------------------------------------------------------
# Global Settings
# -------------------------------------------------------------------
# Network name used by all stacks
NETWORK_NAME=kompose

# Default timezone
TIMEZONE=Europe/Amsterdam

# Admin email (local)
ADMIN_EMAIL=dev@localhost

# Email/SMTP Settings (disabled for local)
EMAIL_TRANSPORT=smtp
EMAIL_FROM=dev@localhost
EMAIL_SMTP_HOST=localhost
EMAIL_SMTP_PORT=1025
EMAIL_SMTP_USER=dev@localhost

# Disable Traefik by default for local dev
TRAEFIK_ENABLED=false

# ===================================================================
# CORE STACK CONFIGURATION
# ===================================================================
CORE_COMPOSE_PROJECT_NAME=core

# PostgreSQL Configuration
CORE_POSTGRES_IMAGE=postgres:16-alpine
DB_USER=kompose
CORE_DB_NAME=kompose
CORE_DB_PORT=5432
CORE_DB_HOST=core-postgres  # Container name for inter-container communication
CORE_POSTGRES_MAX_CONNECTIONS=100
CORE_POSTGRES_SHARED_BUFFERS="256MB"

# Redis Configuration
CORE_REDIS_IMAGE=redis:7-alpine
CORE_REDIS_PORT=6379

# Mosquitto MQTT Configuration
CORE_MOSQUITTO_IMAGE=eclipse-mosquitto:2
CORE_MQTT_PORT=1883
CORE_MQTT_WS_PORT=9001

# Redis Commander (Web UI)
CORE_REDIS_COMMANDER_IMAGE=rediscommander/redis-commander:latest
CORE_REDIS_API_USER=admin
CORE_REDIS_API_PORT=8081
CORE_REDIS_API_TRAEFIK_HOST=localhost:8081

# ===================================================================
# AUTH STACK CONFIGURATION
# ===================================================================
AUTH_COMPOSE_PROJECT_NAME=auth

# Keycloak Configuration
AUTH_DOCKER_IMAGE=quay.io/keycloak/keycloak:latest
AUTH_DB_NAME=keycloak
AUTH_KEYCLOAK_ADMIN_USERNAME=admin
AUTH_KC_HTTP_PORT=8180  # Direct port for local access

# OAuth2 Proxy Configuration (Optional for local)
AUTH_OAUTH2_PROXY_HOST=localhost:4180
AUTH_OAUTH2_CLIENT_ID=kompose-sso

# ===================================================================
# KMPS STACK CONFIGURATION
# ===================================================================
KMPS_COMPOSE_PROJECT_NAME=kmps
KMPS_DB_NAME=kmps
KMPS_TRAEFIK_HOST=localhost:3100
KMPS_APP_PORT=3100
KMPS_API_PORT=8080
KMPS_API_HOST=0.0.0.0

# Keycloak Client Configuration
KMPS_CLIENT_ID=kmps-admin
KMPS_REALM=kompose

# ===================================================================
# HOME STACK CONFIGURATION
# ===================================================================
HOME_COMPOSE_PROJECT_NAME=home

# Home Assistant Configuration
HOME_HOMEASSISTANT_IMAGE=ghcr.io/home-assistant/home-assistant:stable
HOME_HOMEASSISTANT_PORT=8123

# Matter Server Configuration
HOME_MATTER_SERVER_IMAGE=ghcr.io/home-assistant-libs/python-matter-server:stable

# Zigbee2MQTT Configuration
HOME_ZIGBEE2MQTT_IMAGE=koenkk/zigbee2mqtt:latest
HOME_ZIGBEE2MQTT_PORT=8080

# ESPHome Configuration
HOME_ESPHOME_IMAGE=ghcr.io/esphome/esphome:stable

# ===================================================================
# VPN STACK CONFIGURATION
# ===================================================================
VPN_COMPOSE_PROJECT_NAME=vpn

# WireGuard Configuration
VPN_WG_HOST=localhost
VPN_WG_PORT=51820
VPN_WG_PERSISTENT_KEEPALIVE=25
VPN_WG_DEFAULT_DNS=1.1.1.1,1.0.0.1
VPN_WG_DEFAULT_ADDRESS=10.8.0.x
VPN_WG_ALLOWED_IPS=10.8.0.0/24
VPN_WG_MTU=1420

# ===================================================================
# MESSAGING STACK CONFIGURATION
# ===================================================================
MESSAGING_COMPOSE_PROJECT_NAME=messaging

# Gotify Configuration
MESSAGING_GOTIFY_IMAGE=gotify/server:latest
MESSAGING_GOTIFY_PORT=8085
MESSAGING_GOTIFY_TRAEFIK_HOST=localhost:8085

# ===================================================================
# CHAIN STACK CONFIGURATION
# ===================================================================
CHAIN_COMPOSE_PROJECT_NAME=chain

# n8n Configuration
CHAIN_N8N_IMAGE=n8nio/n8n:latest
CHAIN_N8N_PORT=5678
CHAIN_N8N_DB_NAME=n8n
CHAIN_N8N_BASIC_AUTH_USER=admin
CHAIN_N8N_WEBHOOK_URL=http://localhost:5678

# Semaphore Configuration
CHAIN_SEMAPHORE_IMAGE=semaphoreui/semaphore:latest
CHAIN_SEMAPHORE_PORT=3000
CHAIN_SEMAPHORE_DB_NAME=semaphore
CHAIN_SEMAPHORE_ADMIN_USERNAME=admin

# ===================================================================
# CODE STACK CONFIGURATION
# ===================================================================
CODE_COMPOSE_PROJECT_NAME=code

# Gitea Configuration
CODE_GITEA_IMAGE=gitea/gitea:latest
CODE_GITEA_PORT_HTTP=3001
CODE_GITEA_PORT_SSH=2222
CODE_GITEA_DB_NAME=gitea
CODE_GITEA_APP_NAME="Kompose Git (Local)"
CODE_GITEA_RUN_MODE=dev

# Gitea Actions Runner Configuration
CODE_RUNNER_IMAGE=gitea/act_runner:latest

# ===================================================================
# PROXY STACK CONFIGURATION (Optional for local)
# ===================================================================
PROXY_COMPOSE_PROJECT_NAME=proxy

# Traefik Configuration
PROXY_TRAEFIK_IMAGE=traefik:latest
PROXY_TRAEFIK_PORT_HTTP=80
PROXY_TRAEFIK_PORT_HTTPS=443
PROXY_TRAEFIK_PORT_DASHBOARD=8080
PROXY_TRAEFIK_LOG_LEVEL=DEBUG
PROXY_TRAEFIK_ACME_EMAIL=dev@localhost

# ===================================================================
# CUSTOM/UTILITY STACKS CONFIGURATION
# ===================================================================

# Blog Stack
BLOG_COMPOSE_PROJECT_NAME=blog
BLOG_TRAEFIK_HOST=localhost:3002

# Sexy Stack (Directus)
SEXY_COMPOSE_PROJECT_NAME=sexy
SEXY_TRAEFIK_HOST=localhost:8055
SEXY_DB_NAME=directus
SEXY_ADMIN_EMAIL=admin@localhost

# Link Stack
LINK_COMPOSE_PROJECT_NAME=link
LINK_TRAEFIK_HOST=localhost:3009
LINK_DB_NAME=linkwarden

# News Stack
NEWS_COMPOSE_PROJECT_NAME=news
NEWS_TRAEFIK_HOST=localhost:3004
NEWS_DB_NAME=letterspace

# Track Stack (Umami)
TRACK_COMPOSE_PROJECT_NAME=track
TRACK_TRAEFIK_HOST=localhost:3007
TRACK_DB_NAME=umami

# Vault Stack (Vaultwarden)
VAULT_COMPOSE_PROJECT_NAME=vault
VAULT_TRAEFIK_HOST=localhost:8081
VAULT_DB_NAME=vaultwarden
VAULT_SIGNUPS_ALLOWED=true
VAULT_INVITATIONS_ALLOWED=true
VAULT_SHOW_PASSWORD_HINT=true

# ===================================================================
# WATCH STACK CONFIGURATION (Monitoring & Observability)
# ===================================================================
WATCH_COMPOSE_PROJECT_NAME=watch

# Prometheus - Metrics Collection
WATCH_PROMETHEUS_IMAGE=prom/prometheus:latest
WATCH_PROMETHEUS_RETENTION=30d
WATCH_PROMETHEUS_PORT=9090

# Grafana - Metrics Visualization
WATCH_GRAFANA_IMAGE=grafana/grafana:latest
WATCH_GRAFANA_ADMIN_USER=admin
WATCH_GRAFANA_PLUGINS=grafana-clock-panel,grafana-simple-json-datasource,grafana-piechart-panel,grafana-worldmap-panel
WATCH_GRAFANA_DB_NAME=grafana
WATCH_GRAFANA_DB_USER=grafana
WATCH_GRAFANA_PORT=3010

# OpenTelemetry Collector
WATCH_OTEL_IMAGE=otel/opentelemetry-collector-contrib:latest
WATCH_OTEL_GRPC_PORT=4317
WATCH_OTEL_HTTP_PORT=4318
WATCH_OTEL_HEALTH_PORT=13133
WATCH_OTEL_ZPAGES_PORT=55679

# PostgreSQL Exporter
WATCH_POSTGRES_EXPORTER_IMAGE=prometheuscommunity/postgres-exporter:latest
WATCH_POSTGRES_EXPORTER_USER=kompose
WATCH_POSTGRES_EXPORTER_DB=kompose
WATCH_POSTGRES_EXPORTER_PORT=9187

# Redis Exporter
WATCH_REDIS_EXPORTER_IMAGE=oliver006/redis_exporter:latest
WATCH_REDIS_EXPORTER_PORT=9121

# MQTT Exporter
WATCH_MQTT_EXPORTER_IMAGE=kpetrem/mqtt-exporter:latest
WATCH_MQTT_EXPORTER_TOPIC=#
WATCH_MQTT_V5_PROTOCOL=False
WATCH_MQTT_EXPORTER_PORT=9000

# cAdvisor - Container Metrics
WATCH_CADVISOR_IMAGE=gcr.io/cadvisor/cadvisor:latest
WATCH_CADVISOR_PORT=8082

# Node Exporter - Host Metrics
WATCH_NODE_EXPORTER_IMAGE=prom/node-exporter:latest

# Blackbox Exporter - Endpoint Monitoring
WATCH_BLACKBOX_EXPORTER_IMAGE=prom/blackbox-exporter:latest
WATCH_BLACKBOX_EXPORTER_PORT=9115

# Loki - Log Aggregation
WATCH_LOKI_IMAGE=grafana/loki:latest
WATCH_LOKI_PORT=3100

# Promtail - Log Collector
WATCH_PROMTAIL_IMAGE=grafana/promtail:latest
WATCH_PROMTAIL_PORT=9080

# Alertmanager - Alert Management
WATCH_ALERTMANAGER_IMAGE=prom/alertmanager:latest
WATCH_ALERTMANAGER_PORT=9093

# NOTE: Secrets are stored in root secrets.env file
# Available secrets for this stack:
#   - WATCH_PROMETHEUS_AUTH=CHANGE_ME_GENERATE_WITH_KOMPOSE
#   - WATCH_GRAFANA_ADMIN_PASSWORD=CHANGE_ME_GENERATE_WITH_KOMPOSE
#   - WATCH_GRAFANA_DB_PASSWORD=CHANGE_ME_GENERATE_WITH_KOMPOSE
#   - WATCH_POSTGRES_EXPORTER_PASSWORD=CHANGE_ME_GENERATE_WITH_KOMPOSE
#   - WATCH_REDIS_EXPORTER_PASSWORD=CHANGE_ME_GENERATE_WITH_KOMPOSE
#   - WATCH_LOKI_AUTH=CHANGE_ME_GENERATE_WITH_KOMPOSE
#   - WATCH_ALERTMANAGER_AUTH=CHANGE_ME_GENERATE_WITH_KOMPOSE

# ===================================================================
# Local Development Notes
# ===================================================================
# 1. Services accessible directly via ports (no domain routing)
# 2. No SSL/TLS - everything runs on HTTP
# 3. Traefik is optional (set TRAEFIK_ENABLED=true if needed)
# 4. Database host is localhost for direct connection
# 5. Simplified authentication (no OAuth2 Proxy by default)
#
# To activate this configuration:
#   cp .env.production .env
#   cp domain.env.local domain.env
#   OR use: ./kompose.sh prod:start
#
# Services will be available at:
#   - PostgreSQL: localhost:5432
#   - Redis: localhost:6379
#   - Keycloak: http://localhost:8180
#   - KMPS: http://localhost:3100
#   - Gitea: http://localhost:3001
#   - n8n: http://localhost:5678
#   - Home Assistant: http://localhost:8123
#   - etc.
# ===================================================================

# Messaging Stack - Missing Variables
MESSAGING_MAILHOG_PORT=8025
MESSAGING_MAILHOG_IMAGE=mailhog/mailhog:latest
MESSAGING_GOTIFY_IMAGE=gotify/server:latest


# ===================================================================
# IMPORTANT NOTES
# ===================================================================
# This file has been automatically updated by fix-env-production.sh
#
# ⚠️ REMAINING WORK NEEDED:
# 1. Update compose.yaml files to use prefixed variables:
#    - core/compose.yaml: POSTGRES_IMAGE → CORE_POSTGRES_IMAGE
#    - auth/compose.yaml: DOCKER_IMAGE → AUTH_DOCKER_IMAGE
#    - messaging/compose.yaml: GOTIFY_IMAGE → MESSAGING_GOTIFY_IMAGE
#    - vpn/compose.yaml: DOCKER_IMAGE → VPN_DOCKER_IMAGE
#
# 2. Review and test each stack deployment
#
# 3. See ENV_VERIFICATION_REPORT.md for complete details
# ===================================================================
