# ===================================================================
# KOMPOSE - Root Configuration (Centralized)
# ===================================================================
# All stack configurations are managed from this single file
# Stack-specific variables are prefixed with the stack name
# Example: CORE_POSTGRES_PASSWORD, AUTH_KC_ADMIN_USERNAME
#
# Non-sensitive shared configuration for all stacks
# Sensitive values should be in secrets.env (not committed to git)
# ===================================================================

# -------------------------------------------------------------------
# Domain Configuration
# -------------------------------------------------------------------
# Domain configuration is centralized in domain.env
# This sets ROOT_DOMAIN and all SUBDOMAIN_* variables
include domain.env

# Build Traefik hostnames from domain configuration
TRAEFIK_HOST_PROXY=${SUBDOMAIN_PROXY}.${ROOT_DOMAIN}
TRAEFIK_HOST_AUTH=${SUBDOMAIN_AUTH}.${ROOT_DOMAIN}
TRAEFIK_HOST_AUTO=${SUBDOMAIN_AUTO}.${ROOT_DOMAIN}
TRAEFIK_HOST_BLOG=${SUBDOMAIN_BLOG}.${ROOT_DOMAIN}
TRAEFIK_HOST_CHAIN=${SUBDOMAIN_CHAIN}.${ROOT_DOMAIN}
TRAEFIK_HOST_CHAT=${SUBDOMAIN_CHAT}.${ROOT_DOMAIN}
TRAEFIK_HOST_MAIL=${SUBDOMAIN_MAIL}.${ROOT_DOMAIN}
TRAEFIK_HOST_CODE=${SUBDOMAIN_CODE}.${ROOT_DOMAIN}
TRAEFIK_HOST_DASH=${SUBDOMAIN_DASH}.${ROOT_DOMAIN}
TRAEFIK_HOST_DATA=${SUBDOMAIN_DATA}.${ROOT_DOMAIN}
TRAEFIK_HOST_DOCK=${SUBDOMAIN_DOCK}.${ROOT_DOMAIN}
TRAEFIK_HOST_DOCS=${SUBDOMAIN_DOCS}.${ROOT_DOMAIN}
TRAEFIK_HOST_HOME=${SUBDOMAIN_HOME}.${ROOT_DOMAIN}
TRAEFIK_HOST_LINK=${SUBDOMAIN_LINK}.${ROOT_DOMAIN}
TRAEFIK_HOST_NEWS=${SUBDOMAIN_NEWS}.${ROOT_DOMAIN}
TRAEFIK_HOST_SEXY=${SUBDOMAIN_SEXY}.${ROOT_DOMAIN}
TRAEFIK_HOST_TRACE=${SUBDOMAIN_TRACE}.${ROOT_DOMAIN}
TRAEFIK_HOST_TRACK=${SUBDOMAIN_TRACK}.${ROOT_DOMAIN}
TRAEFIK_HOST_VAULT=${SUBDOMAIN_VAULT}.${ROOT_DOMAIN}
TRAEFIK_HOST_VPN=${SUBDOMAIN_VPN}.${ROOT_DOMAIN}
TRAEFIK_HOST_OAUTH2=${SUBDOMAIN_OAUTH2}.${ROOT_DOMAIN}
TRAEFIK_HOST_ZIGBEE=zigbee.${ROOT_DOMAIN}

# -------------------------------------------------------------------
# Global Settings
# -------------------------------------------------------------------
# Network name used by all stacks
NETWORK_NAME=kompose

# Default timezone for all containers
TIMEZONE=Europe/Amsterdam

# Admin email
ADMIN_EMAIL=valknar@${ROOT_DOMAIN}

# Email/SMTP Settings
EMAIL_TRANSPORT=smtp
EMAIL_FROM=hi@${ROOT_DOMAIN}
EMAIL_SMTP_HOST=smtp.ionos.de
EMAIL_SMTP_PORT=465
EMAIL_SMTP_USER=hi@${ROOT_DOMAIN}
# EMAIL_SMTP_PASSWORD is in secrets.env

# Enable Traefik integration by default
TRAEFIK_ENABLED=true

# ===================================================================
# CORE STACK CONFIGURATION
# ===================================================================
CORE_COMPOSE_PROJECT_NAME=core

# PostgreSQL Configuration
CORE_POSTGRES_IMAGE=postgres:16-alpine
CORE_DB_USER=valknar
CORE_DB_NAME=kompose
CORE_DB_PORT=5432
CORE_DB_HOST=core-postgres
CORE_POSTGRES_MAX_CONNECTIONS=100
CORE_POSTGRES_SHARED_BUFFERS=256MB
# CORE_DB_PASSWORD is in secrets.env

# Redis Configuration
CORE_REDIS_IMAGE=redis:7-alpine
# CORE_REDIS_PASSWORD is in secrets.env

# Mosquitto MQTT Configuration
CORE_MOSQUITTO_IMAGE=eclipse-mosquitto:2
CORE_MQTT_PORT=1883
CORE_MQTT_WS_PORT=9001

# Redis Commander (Web UI)
CORE_REDIS_COMMANDER_IMAGE=rediscommander/redis-commander:latest
CORE_REDIS_API_USER=admin
CORE_REDIS_API_PORT=8081
CORE_REDIS_API_TRAEFIK_HOST=redis.${ROOT_DOMAIN}
# CORE_REDIS_API_PASSWORD is in secrets.env

# ===================================================================
# AUTH STACK CONFIGURATION
# ===================================================================
AUTH_COMPOSE_PROJECT_NAME=auth

# Keycloak Configuration
AUTH_DOCKER_IMAGE=quay.io/keycloak/keycloak:latest
AUTH_DB_NAME=keycloak
AUTH_KC_ADMIN_USERNAME=admin
# AUTH_KC_ADMIN_PASSWORD is in secrets.env

# OAuth2 Proxy Configuration
AUTH_OAUTH2_PROXY_HOST=${TRAEFIK_HOST_OAUTH2}
AUTH_OAUTH2_CLIENT_ID=kompose-sso
# AUTH_OAUTH2_CLIENT_SECRET is in secrets.env
# AUTH_OAUTH2_COOKIE_SECRET is in secrets.env

# ===================================================================
# KMPS STACK CONFIGURATION
# ===================================================================
KMPS_COMPOSE_PROJECT_NAME=kmps
KMPS_DB_NAME=kmps
# Additional KMPS configuration as needed

# ===================================================================
# HOME STACK CONFIGURATION
# ===================================================================
HOME_COMPOSE_PROJECT_NAME=home

# Home Assistant Configuration
HOME_HOMEASSISTANT_IMAGE=ghcr.io/home-assistant/home-assistant:stable
HOME_HOMEASSISTANT_PORT=8123

# Matter Server Configuration
HOME_MATTER_SERVER_IMAGE=ghcr.io/home-assistant-libs/python-matter-server:stable

# Zigbee2MQTT Configuration (Optional)
HOME_ZIGBEE2MQTT_IMAGE=koenkk/zigbee2mqtt:latest
HOME_ZIGBEE2MQTT_PORT=8080
# HOME_ZIGBEE_DEVICE=/dev/ttyUSB0

# ESPHome Configuration (Optional)
HOME_ESPHOME_IMAGE=ghcr.io/esphome/esphome:stable

# ===================================================================
# VPN STACK CONFIGURATION
# ===================================================================
VPN_COMPOSE_PROJECT_NAME=vpn

# WireGuard (wg-easy) Configuration
VPN_WG_HOST=${TRAEFIK_HOST_VPN}
VPN_WG_PORT=51820
VPN_WG_PERSISTENT_KEEPALIVE=25
VPN_WG_DEFAULT_DNS=1.1.1.1,1.0.0.1
VPN_WG_DEFAULT_ADDRESS=10.8.0.x
VPN_WG_ALLOWED_IPS=10.8.0.0/24
VPN_WG_MTU=1420
# VPN_WG_PASSWORD is in secrets.env

# ===================================================================
# MESSAGING STACK CONFIGURATION
# ===================================================================
MESSAGING_COMPOSE_PROJECT_NAME=messaging

# Gotify Configuration
MESSAGING_GOTIFY_IMAGE=gotify/server:latest
MESSAGING_GOTIFY_PORT=8080
MESSAGING_GOTIFY_TRAEFIK_HOST=${TRAEFIK_HOST_CHAT}
# MESSAGING_GOTIFY_ADMIN_PASSWORD is in secrets.env

# ===================================================================
# CHAIN STACK CONFIGURATION
# ===================================================================
CHAIN_COMPOSE_PROJECT_NAME=chain

# n8n Configuration
CHAIN_N8N_IMAGE=n8nio/n8n:latest
CHAIN_N8N_PORT=5678
CHAIN_N8N_DB_NAME=n8n
CHAIN_N8N_BASIC_AUTH_USER=admin
CHAIN_N8N_WEBHOOK_URL=https://${TRAEFIK_HOST_CHAIN}
# CHAIN_N8N_ENCRYPTION_KEY is in secrets.env
# CHAIN_N8N_BASIC_AUTH_PASSWORD is in secrets.env

# Semaphore Configuration
CHAIN_SEMAPHORE_IMAGE=semaphoreui/semaphore:latest
CHAIN_SEMAPHORE_PORT=3000
CHAIN_SEMAPHORE_DB_NAME=semaphore
CHAIN_SEMAPHORE_ADMIN_USERNAME=admin
# CHAIN_SEMAPHORE_ADMIN_PASSWORD is in secrets.env
# CHAIN_SEMAPHORE_RUNNER_TOKEN is in secrets.env

# ===================================================================
# CODE STACK CONFIGURATION
# ===================================================================
CODE_COMPOSE_PROJECT_NAME=code

# Gitea Configuration
CODE_GITEA_IMAGE=gitea/gitea:latest
CODE_GITEA_PORT_HTTP=3001
CODE_GITEA_PORT_SSH=2222
CODE_GITEA_DB_NAME=gitea
CODE_GITEA_APP_NAME=Kompose Git
CODE_GITEA_RUN_MODE=prod
# CODE_GITEA_SECRET_KEY is in secrets.env
# CODE_GITEA_INTERNAL_TOKEN is in secrets.env
# CODE_GITEA_OAUTH2_JWT_SECRET is in secrets.env

# Gitea Actions Runner Configuration
CODE_RUNNER_IMAGE=gitea/act_runner:latest
# CODE_RUNNER_TOKEN is in secrets.env

# ===================================================================
# PROXY STACK CONFIGURATION
# ===================================================================
PROXY_COMPOSE_PROJECT_NAME=proxy

# Traefik Configuration
PROXY_TRAEFIK_IMAGE=traefik:latest
PROXY_TRAEFIK_PORT_HTTP=80
PROXY_TRAEFIK_PORT_HTTPS=443
PROXY_TRAEFIK_PORT_DASHBOARD=8080
PROXY_TRAEFIK_LOG_LEVEL=INFO
PROXY_TRAEFIK_ACME_EMAIL=${ACME_EMAIL}
# PROXY_TRAEFIK_DASHBOARD_AUTH is in secrets.env

# ===================================================================
# CUSTOM/UTILITY STACKS CONFIGURATION
# ===================================================================

# Blog Stack
BLOG_COMPOSE_PROJECT_NAME=blog
BLOG_TRAEFIK_HOST=${TRAEFIK_HOST_BLOG}

# Sexy Stack (Directus)
SEXY_COMPOSE_PROJECT_NAME=sexy
SEXY_TRAEFIK_HOST=${TRAEFIK_HOST_SEXY}
SEXY_DB_NAME=directus
SEXY_ADMIN_EMAIL=${ADMIN_EMAIL}
# SEXY_SECRET is in secrets.env
# SEXY_ADMIN_PASSWORD is in secrets.env

# Link Stack
LINK_COMPOSE_PROJECT_NAME=link
LINK_TRAEFIK_HOST=${TRAEFIK_HOST_LINK}
LINK_DB_NAME=linkwarden

# News Stack
NEWS_COMPOSE_PROJECT_NAME=news
NEWS_TRAEFIK_HOST=${TRAEFIK_HOST_NEWS}
NEWS_DB_NAME=letterspace
# NEWS_JWT_SECRET is in secrets.env

# Track Stack (Umami)
TRACK_COMPOSE_PROJECT_NAME=track
TRACK_TRAEFIK_HOST=${TRAEFIK_HOST_TRACK}
TRACK_DB_NAME=umami
# TRACK_APP_SECRET is in secrets.env

# Vault Stack (Vaultwarden)
VAULT_COMPOSE_PROJECT_NAME=vault
VAULT_TRAEFIK_HOST=${TRAEFIK_HOST_VAULT}
VAULT_DB_NAME=vaultwarden
VAULT_SIGNUPS_ALLOWED=true
VAULT_INVITATIONS_ALLOWED=true
VAULT_SHOW_PASSWORD_HINT=true
# VAULT_ADMIN_TOKEN is in secrets.env (optional)

# Watch Stack
WATCH_COMPOSE_PROJECT_NAME=watch
WATCH_DB_NAME=watchtower

# ===================================================================
# STACK VARIABLE MAPPING
# ===================================================================
# These mappings allow stacks to use generic variable names
# while being scoped to their specific values

# For backward compatibility and easier compose file readability,
# each stack will get its scoped variables exposed with generic names:
# Example: When running core stack, CORE_DB_USER becomes DB_USER

# This is handled by the kompose.sh script using environment variable
# filtering and renaming based on the stack being executed.

# ===================================================================
# Configuration Notes
# ===================================================================
# 1. Stack Scoping:
#    - All variables are prefixed with STACKNAME_ (e.g., CORE_, AUTH_)
#    - The kompose.sh script filters and maps these to generic names
#    - This allows centralized management while maintaining isolation
#
# 2. Secrets Management:
#    - All sensitive data must be in secrets.env
#    - Use: ./kompose.sh secrets generate
#    - Never commit secrets.env to git
#
# 3. Shared Variables:
#    - Some variables are shared across stacks (e.g., DB_USER, NETWORK_NAME)
#    - These are defined at the top without stack prefixes
#
# 4. Adding New Stacks:
#    - Add a new section with NEWSTACK_ prefix
#    - Define all required variables
#    - Update kompose.sh if needed
#    - Document in _docs/content/stacks/
#
# 5. Testing:
#    - Test each stack individually: ./kompose.sh up <stack>
#    - Verify environment: docker-compose config (in stack dir)
#
# ===================================================================
